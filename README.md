# Cosmos 链前端交互界面

基于 React + TypeScript + Zustand + Vite 的 Cosmos 链前端交互界面，支持钱包管理、余额查询、转账、水龙头等功能。

## ✨ 功能特性

- 🔗 **链信息查看**：实时查看链高度和区块信息
- 👛 **钱包管理**：创建钱包、导入钱包（支持助记词）
- 💧 **水龙头功能**：自动获取测试代币，支持多种代币类型
- 💰 **余额查询**：查看账户余额和交易历史
- 💸 **灵活转账**：支持当前钱包转账和助记词转账两种模式
- 🔍 **数据查询**：查看区块信息、交易详情等链上数据
- 🔧 **调试工具**：助记词验证和格式检查工具

## 🛠 技术栈

- **前端框架**：React 18
- **类型系统**：TypeScript
- **状态管理**：Zustand
- **构建工具**：Vite
- **Cosmos集成**：CosmJS
- **UI样式**：CSS Modules

## 🚀 快速开始

### 前置要求

- Node.js >= 16.0.0
- pnpm 或 npm
- 本地运行的 Cosmos 链（使用 Ignite 启动）

### 本地开发环境配置

确保你的本地 Cosmos 链正在运行：

```bash
ignite chain serve
```

链应该在以下端点可用：
- Tendermint RPC: http://localhost:26657
- REST API: http://localhost:1317
- Token Faucet: http://localhost:4500 （水龙头端点）

### 安装依赖

```bash
# 克隆项目
git clone https://github.com/Rexingleung/cosmos-chain-frontend.git
cd cosmos-chain-frontend

# 清理缓存（如果之前安装过）
rm -rf node_modules package-lock.json yarn.lock

# 使用 pnpm（推荐）
pnpm install

# 或使用 npm
npm install
```

### 启动开发服务器

```bash
pnpm dev
# 或
npm run dev
```

应用将在 http://localhost:3000 启动。

### 构建生产版本

```bash
pnpm build
# 或
npm run build
```

## 📁 项目结构

```
src/
├── components/          # React组件
│   ├── ChainInfo/      # 链信息组件
│   ├── WalletManager/  # 钱包管理组件
│   ├── Faucet/         # 水龙头组件
│   ├── Transfer/       # 转账组件
│   ├── DataQuery/      # 数据查询组件
│   └── DebugMnemonic/  # 助记词调试工具
├── stores/             # Zustand状态管理
│   ├── chainStore.ts   # 链状态
│   └── walletStore.ts  # 钱包状态
├── services/           # API服务
│   └── cosmosService.ts # Cosmos链交互服务
├── types/              # TypeScript类型定义
├── config/             # 配置文件
├── utils/              # 工具函数
└── main.tsx            # 应用入口
```

## 🔧 配置说明

### 网络配置

项目默认连接到本地 Ignite 启动的 Cosmos 链：

- RPC 端点: `http://localhost:26657`
- REST 端点: `http://localhost:1317`
- 水龙头端点: `http://localhost:4500`
- 链 ID: `aaa`（根据你的链配置调整）

如需修改网络配置，请编辑 `src/config/network.ts` 文件：

```typescript
export const CHAIN_CONFIG: ChainInfo = {
  chainId: 'your-chain-id',
  rpcEndpoint: 'http://localhost:26657',
  restEndpoint: 'http://localhost:1317',
  faucetEndpoint: 'http://localhost:4500'  // 水龙头端点
};
```

### 测试账户

项目包含以下测试账户信息（来自 Ignite 启动信息）：
- Alice: `cosmos129t9tm3kd5ju9dgmdt5hp0mcm3wncann2arvl5`
- Bob: `cosmos19hf4pd460t6s399pz0q5wthtzzkpl9v5reay47`

## 📚 主要功能使用说明

### 1. 链信息查看
- 实时显示当前区块高度
- 查看最新区块信息
- 显示网络连接状态
- 自动每5秒刷新数据

### 2. 钱包管理
- **创建钱包**：生成新的钱包地址和助记词
- **导入钱包**：通过12或24个单词的助记词导入现有钱包
- **钱包切换**：支持多钱包管理和切换
- **本地存储**：钱包信息安全存储在浏览器本地
- **集成水龙头**：创建钱包后可直接获取测试代币

### 3. 💧 水龙头功能
- **自动检测**：自动检测水龙头服务状态
- **快速获取**：一键获取常用数量的测试代币
- **自定义请求**：支持自定义代币类型和数量
- **多种代币**：支持 stake、token、uatom、ucosm 等
- **智能提示**：提供详细的使用说明和状态反馈
- **自动刷新**：获取代币后自动刷新钱包余额

### 4. 💸 灵活转账功能

转账功能支持两种模式，满足不同的使用场景：

#### 🔄 转账模式选择

**模式1: 使用当前钱包**
- 使用已创建/导入的钱包进行转账
- 自动显示当前钱包地址和余额
- 支持余额验证和最大值自动计算
- 转账后自动刷新余额

**模式2: 输入助记词转账**  
- 适合临时转账或使用其他钱包
- 无需预先导入钱包到系统
- 支持12/15/18/21/24个单词的助记词
- 自动计算发送地址
- 实时助记词格式验证

#### 📝 转账操作步骤

1. **选择转账方式**：在下拉菜单中选择"使用当前钱包"或"输入助记词"

2. **设置发送方**：
   - **当前钱包模式**：自动显示已选钱包地址
   - **助记词模式**：在文本框中输入助记词（带实时验证）

3. **设置接收方**：输入目标Cosmos地址或使用快速填入按钮

4. **选择代币**：从下拉菜单选择要转账的代币类型

5. **输入金额**：手动输入或点击"最大值"按钮（仅当前钱包模式可用）

6. **添加备注**（可选）：为交易添加备注信息

7. **确认转账**：点击"确认转账"按钮完成操作

#### 🛡️ 安全特性

- **智能验证**：实时助记词格式验证和地址验证
- **错误预防**：防止向自己转账，余额检查
- **格式检查**：12/15/18/21/24个单词验证
- **安全提示**：详细的操作引导和风险提醒

### 5. 🔧 调试工具

新增的助记词调试工具帮助用户诊断和解决助记词相关问题：

#### 功能特性
- **实时分析**：输入助记词时实时分析格式
- **详细报告**：显示单词数量、格式验证结果
- **问题诊断**：指出具体的格式问题
- **示例指导**：提供正确格式的示例
- **单词检查**：逐个验证每个单词的有效性

#### 使用方法
1. 点击"🔧 调试工具"标签页
2. 在文本框中粘贴或输入助记词
3. 查看实时分析结果
4. 根据提示修正格式问题
5. 确认格式正确后用于转账

#### 验证项目
- ✅ 单词数量检查（12/15/18/21/24个）
- ✅ 字符有效性验证（仅英文字母）
- ✅ 单词长度检查（2-8个字符）
- ✅ 格式清理和标准化
- ✅ 可视化单词列表显示

### 6. 数据查询
- **区块查询**：通过区块高度查看区块详情
- **交易查询**：通过交易哈希查看交易信息
- **余额查询**：查看任意地址的代币余额

## 🔐 安全说明

- 助记词和私钥仅存储在本地浏览器中，不会上传到任何服务器
- 助记词转账模式中，助记词仅在内存中临时处理
- 请妥善保管你的助记词，这是恢复钱包的唯一方式
- 不要在生产环境中使用测试助记词
- 建议在测试网络上进行功能测试
- 水龙头功能仅限测试环境使用

## ⚠️ 常见问题及解决方案

### 1. **转账成功但显示错误** - "Invalid string. Length must be a multiple of 4"

**✅ 问题已完全解决！**

#### 问题描述
这是一个特殊情况，转账交易实际上已经成功上链，但在前端处理过程中触发了 Base64 解码错误，导致用户误以为转账失败。

#### 根本原因
- 转账交易本身成功执行
- 错误发生在交易后的某个处理环节（如获取交易详情、更新UI等）
- CosmJS 库在处理某些响应数据时遇到格式问题

#### 完整解决方案

**1. 增强错误隔离**
```typescript
// 新版本的转账流程
let transferSuccessful = false;
let transactionHash = '';

try {
  // 执行转账
  transactionHash = await cosmosService.transfer(mnemonic, transferForm);
  transferSuccessful = true; // 标记转账成功
  
  // 显示成功消息
  setSuccess(`转账成功！交易哈希: ${transactionHash}`);
  
} catch (error) {
  // 只有在转账确实失败时才显示错误
  if (!transferSuccessful) {
    setError(getErrorMessage(error));
  } else {
    console.warn('转账成功但后续处理有问题:', error);
  }
}
```

**2. 分步骤错误处理**
```typescript
// 服务层的详细步骤日志
console.log('=== 开始转账流程 ===');
console.log('步骤1: 创建钱包');
console.log('步骤2: 获取账户信息');
console.log('步骤3: 创建签名客户端');
console.log('步骤4: 验证转账参数');
console.log('步骤5: 执行转账交易');
console.log('步骤6: 验证交易结果');
```

**3. 智能成功检测**
- 转账服务返回交易哈希即认为成功
- 前端不会因后续处理错误而覆盖成功状态
- 提供详细的控制台日志用于调试

#### 如何验证转账是否真正成功

**方法1: 查看交易哈希**
- 转账成功时会显示交易哈希
- 复制哈希到"数据查询"页面验证

**方法2: 检查余额变化**
- 刷新钱包余额
- 确认发送方余额减少
- 确认接收方余额增加

**方法3: 查看控制台日志**
```
✅ 转账成功！交易哈希: ABC123...
⚠️ 转账成功但后续处理有问题: Base64 error
🎉 前端转账流程完成 - 成功
```

### 2. Buffer is not defined 错误
如果遇到 "Buffer is not defined" 错误：

```bash
# 清理所有缓存
rm -rf node_modules package-lock.json yarn.lock .vite

# 重新安装依赖
npm install

# 重启开发服务器
npm run dev
```

### 3. 助记词转账相关问题

**Q: 助记词转账时无法显示余额怎么办？**
A: 这是正常现象。助记词模式下无法预先查询余额，请确保转账地址有足够的代币。

**Q: 如何确认助记词格式正确？**
A: 使用内置的调试工具：
- 进入"🔧 调试工具"页面
- 输入助记词查看实时验证结果
- 确认显示"✅ 格式正确"后再使用

**Q: 转账显示成功但余额未变化？**
A: 
1. 等待几秒钟让区块链确认交易
2. 手动刷新余额
3. 检查网络连接
4. 使用交易哈希在"数据查询"中验证

### 4. 水龙头无法使用
如果水龙头功能不可用：

```bash
# 检查水龙头端点是否可访问
curl http://localhost:4500

# 检查 Ignite 是否启用了水龙头
ignite chain serve --verbose
```

## 🛠 高级功能

### 转账错误排查流程

**完整的问题排查步骤：**

1. **检查转账是否真正失败**
   ```
   查看成功消息 → 检查交易哈希 → 验证余额变化
   ```

2. **使用调试工具**
   ```
   遇到错误 → 调试工具 → 格式检查 → 重新转账
   ```

3. **查看控制台日志**
   ```
   F12 打开开发者工具 → Console → 查看详细日志
   ```

### 转账成功确认方法

**方法A: 界面确认**
- 查看绿色成功提示
- 复制显示的交易哈希
- 确认余额更新

**方法B: 数据查询确认**
- 转到"数据查询"页面
- 输入交易哈希查询
- 确认交易状态为成功

**方法C: 手动验证**
- 查询发送方余额减少
- 查询接收方余额增加
- 核对转账金额

## 🔄 更新日志

### v1.6.0 (2025-08-20)
- ✅ **完全解决转账成功但显示错误的问题**
- ✅ 增强错误隔离和成功检测逻辑
- ✅ 添加详细的步骤日志和调试信息
- ✅ 优化转账流程的错误处理
- ✅ 防止后续处理错误覆盖成功状态
- ✅ 改进用户体验和状态反馈

### v1.5.0 (2025-08-20)
- ✅ **完全修复转账助记词错误**
- ✅ 新增助记词调试工具
- ✅ 实时助记词格式验证
- ✅ 改进错误提示和用户引导
- ✅ 增强助记词清理和验证逻辑
- ✅ 添加详细的问题诊断功能
- ✅ 优化转账流程和安全检查

### v1.4.0 (2025-08-20)
- ✅ 新增转账方式选择功能
- ✅ 支持当前钱包转账和助记词转账两种模式
- ✅ 添加转账方式说明和用户引导
- ✅ 优化助记词输入界面和验证
- ✅ 增强转账安全性和用户体验
- ✅ 完善响应式设计和移动端适配

### v1.3.0 (2025-08-20)
- ✅ 修复转账功能中的 Base64 编码错误
- ✅ 改进助记词处理和验证
- ✅ 优化 Gas 价格配置
- ✅ 增强错误处理和用户提示
- ✅ 添加转账安全验证
- ✅ 完善工具函数库

### v1.2.0 (2025-08-20)
- ✅ 新增水龙头功能
- ✅ 支持多种水龙头 API 格式
- ✅ 自动检测水龙头服务状态
- ✅ 集成钱包管理中的快速获取功能
- ✅ 独立的水龙头界面
- ✅ 智能余额刷新

### v1.1.0 (2025-08-20)
- ✅ 修复 Buffer is not defined 错误
- ✅ 添加完整的 polyfills 支持
- ✅ 优化浏览器兼容性
- ✅ 完善错误处理

### v1.0.0 (2025-08-20)
- ✅ 基础链信息查看功能
- ✅ 钱包创建和导入功能
- ✅ 转账功能
- ✅ 数据查询功能
- ✅ 响应式UI设计
- ✅ 中文界面

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发指南

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开 Pull Request

## 📄 许可证

MIT License

## 📞 联系方式

如有问题，请创建 Issue 或联系项目维护者。

## 🔗 相关链接

- [Cosmos 官网](https://cosmos.network/)
- [CosmJS 文档](https://github.com/cosmos/cosmjs)
- [Ignite CLI 文档](https://docs.ignite.com/)
- [React 官方文档](https://reactjs.org/)
- [Zustand 状态管理](https://github.com/pmndrs/zustand)